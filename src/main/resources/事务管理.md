

##### 事务管理

1. mybatis 事务接口

```
/**
 * Wraps a database connection.
 * Handles the connection lifecycle that comprises: its creation, preparation, commit/rollback and close.
 *
 * @author Clinton Begin
 */
public interface Transaction {

  /**
   * Retrieve inner database connection.
   * @return DataBase connection
   * @throws SQLException
   */
  Connection getConnection() throws SQLException;

  /**
   * Commit inner database connection.
   * @throws SQLException
   */
  void commit() throws SQLException;

  /**
   * Rollback inner database connection.
   * @throws SQLException
   */
  void rollback() throws SQLException;

  /**
   * Close inner database connection.
   * @throws SQLException
   */
  void close() throws SQLException;

  /**
   * Get transaction timeout if set.
   * @throws SQLException
   */
  Integer getTimeout() throws SQLException;

}
```

以上是mybatis的事务接口, 提供了在获取Session是否设置自动提交, 提交事务, 回滚事务, 关闭connection的功能.

其实对应jdbc api:
```
Connection connection = dataSource.getConnection();

// connection.setTransactionIsolation(level.getLevel()); //设置事务隔离级别

// 设置是否自动提交, 如果不是自动提交, 则是开启事务
connection.setAutoCommit(desiredAutoCommit);


// connection预编译statement, 并执行sql
Statement stmt=connection.preparedStatement();
stmt.execute(sql);


// 提交事务, 或者回滚
connection.commit();
//connection.rollback();


```


2. mybatis事务执行过程

1) 在配置文件中配置事务管理器
2) 解析配置, 并将事务管理器保存在Configuration中
3) Executor执行commands时, 先委派给transaction获取connection, 然后使用connection执行sql语句
4) SqlSession 提交事务,或者回滚事务, 委派给Executor执行, Executor委派给transaction执行










